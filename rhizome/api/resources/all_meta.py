from tastypie import fields
from django.contrib.auth.models import User

from rhizome.api.resources.base_non_model import BaseNonModelResource
from rhizome.models.indicator_models import Indicator, IndicatorTag, \
    IndicatorToTag
from rhizome.models.location_models import Location
# from rhizome.models.document_models import * # FIXME
from rhizome.models.dashboard_models import CustomChart, CustomDashboard

class AllMetaResult(object):
    charts = list()
    dashboards = list()
    indicators = list()
    indicator_tags = list()
    indicators_to_tags = list()
    locations = list()
    is_superuser = bool()


class AllMetaResource(BaseNonModelResource):
    '''
    **GET Request** Returns all camapaigns, charts, dashboards, indicators,indicator_tags, locations and offices in the database.
        - *Required Parameters:*
            none
    '''
    campaigns = fields.ListField(attribute='campaigns')
    charts = fields.ListField(attribute='charts')
    dashboards = fields.ListField(attribute='dashboards')
    indicators = fields.ListField(attribute='indicators')
    indicator_tags = fields.ListField(attribute='indicator_tags')
    indicators_to_tags = fields.ListField(attribute='indicators_to_tags')
    locations = fields.ListField(attribute='locations')
    offices = fields.ListField(attribute='offices')
    is_superuser = fields.BooleanField(attribute='is_superuser')

    class Meta(BaseNonModelResource.Meta):
        object_class = AllMetaResult
        resource_name = 'all_meta'

    def get_object_list(self, request):
        qs = []
        am_result = AllMetaResult()
        am_result.campaigns = []
        am_result.charts = [{
            'chart_json': x.chart_json,
            'uuid': x.uuid,
            'id': x.id,
            'title':x.title
        } for x in CustomChart.objects.all()]

        am_result.dashboards = \
            list(CustomDashboard.objects.all().values())
        am_result.indicators = \
            list(Indicator.objects.all().values())
        am_result.indicator_tags = \
            list(IndicatorTag.objects.all().values())
        am_result.indicators_to_tags =\
            list(IndicatorToTag.objects.all().values())

        am_result.locations = list(Location.objects.all().values())
        am_result.is_superuser = True #User.objects.get(
            # id=request.user.id).is_superuser    
        qs.append(am_result)

        return [x.__dict__ for x in qs]

build:
  test:
    image: python:2.7-alpine
    environment:
      ENV: CI
    commands:
      - echo "this is a python app  "
    when:
      event:
        - push

# runs `docker build` and `docker push` to the specified GCR
publish:
  gcr:
    repo: inspiring-cat-165403/rhizome
    tag: "$$COMMIT"
    token: >
       $$GOOGLE_CREDENTIALS
    when:
      branch: master
      event: push

deploy:

  gae:
    image: nytimes/drone-gae
    action: deploy
    project: my-gae-project
    flex_image: gcr.io/inspiring-cat-165403/rhizome:$$COMMIT
    version: "$$COMMIT"
    addl_flags:
     - --stop-previous-version
    token: >
      $$GOOGLE_CREDENTIALS
    when:
      event: push
      branch: master
